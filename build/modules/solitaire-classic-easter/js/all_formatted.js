(R=R||{}).BASE_GAME_WIDTH=1138,R.BASE_GAME_HEIGHT=640,R.MAX_GAME_WIDTH=1138,R.MIN_GAME_WIDTH=830,R.MIN_GAME_HEIGHT=780,R.gameWidth=R.BASE_GAME_WIDTH,R.gameHeight=R.BASE_GAME_HEIGHT,R.halfGameWidth=.5*R.gameWidth,R.halfGameHeight=.5*R.gameHeight,R.prevWindowWidth=0,R.prevWindowHeight=0,R.fontName="Helvetica",R.language="en",R.strings=null,R.sfx={},R.playerData={isFirstStart:!0,gamesWon1:0,gamesPlayed1:0,bestScore1:0,leastMoves1:0,bestTime1:0,totalTime1:0,gamesWon3:0,gamesPlayed3:0,bestScore3:0,leastMoves3:0,bestTime3:0,totalTime3:0},R.saveGame=function(){window.famobi.localStorage&&window.famobi.localStorage.setItem("SolitaireClassicSaveSata",JSON.stringify(R.playerData))},R.loadGame=function(){if(window.famobi.localStorage){var t=window.famobi.localStorage.getItem("SolitaireClassicSaveSata");t&&(R.playerData=JSON.parse(t))}};var game=null;window.famobi_onload=function(){var t=Phaser.AUTO,e=detect.parse(window.navigator.userAgent);"SM-T110"!=e.device.family&&"SM-T111"!=e.device.family||(t=Phaser.CANVAS),game=new Phaser.Game(R.BASE_GAME_WIDTH,R.BASE_GAME_HEIGHT,t,"gameContainer",BootState)},(R=R||{}).bitmapData=null,R.bmdSize=10,R.sceneTransition=function(t,e){R.bitmapData||(R.bitmapData=game.add.bitmapData(R.bmdSize,R.bmdSize),R.bitmapData.ctx.beginPath(),R.bitmapData.ctx.rect(0,0,R.bmdSize,R.bmdSize),R.bitmapData.ctx.fillStyle="#000000",R.bitmapData.ctx.fill());var i=game.add.sprite(0,0,R.bitmapData);i.scale.set(game.width/R.bmdSize,game.height/R.bmdSize),e&&(i.alpha=0),game.add.tween(i).to({alpha:1-i.alpha},t,Phaser.Easing.Linear.None,!0).onComplete.add(function(){if(e)game.state.start(e);else{i.destroy();var t=game.state.getCurrentState();"start"in t&&"function"==typeof t.start&&t.start()}})},(R=R||{}).createText=function(t,e,i,s,o,n,a,r){var h=game.add.text(t,e,s);return h.font=R.fontName,h.anchor.set(1,.5),h.align="right",h.fontSize=i,h.fill=o,h.fontWeight="100",n&&(h.stroke="#000000",h.strokeThickness=a),r&&(h.wordWrap=!0,h.wordWrapWidth=game.width),h},R.SoundButton=function(t,e,i,s){Phaser.Button.call(this,game,t,e,"gui",this.onClick,this,i,i,"sound_button_pushed",i),this.anchor.set(.5),this.frameOn=i,this.frameOff=s,this.checkFrame(),R.sfx.button&&this.setDownSound(R.sfx.button),this.exists=game.device.webAudio},R.SoundButton.prototype=Object.create(Phaser.Button.prototype),R.SoundButton.prototype.constructor=R.SoundButton,R.SoundButton.prototype.checkFrame=function(){var t=game.sound.mute?this.frameOff:this.frameOn;this.setFrames(t,t,"sound_button_pushed",t)},R.SoundButton.prototype.onClick=function(){game.sound.mute=!game.sound.mute,window.famobi_analytics.trackEvent("EVENT_VOLUMECHANGE",{bgmVolume:game.sound.mute?0:1,sfxVolume:game.sound.mute?0:1}),this.checkFrame()},R.OptionsScreen=function(){Phaser.Sprite.call(this,game,0,0,null),this.bg=game.add.sprite(0,0,"bg_options"),this.bg.anchor.set(.5),this.addChild(this.bg),this.optionsIcon=game.add.sprite(0,0,"gui","options_icon"),this.optionsIcon.anchor.set(.5),this.addChild(this.optionsIcon);var t=game.add.button(0,0,"gui",this.onLayoutButton,this,"hand_right_button","hand_right_button","hand_button_pushed","hand_right_button");t.anchor.set(.5),R.sfx.button&&t.setDownSound(R.sfx.button),this.addChild(t),this.layoutButton=t;var e=game.add.button(0,0,"gui",this.onModeButton,this,"mode1_button","mode1_button","mode_button_pushed","mode1_button");e.anchor.set(.5),R.sfx.button&&e.setDownSound(R.sfx.button),this.addChild(e),this.modeButton=e,this.soundButton=new R.SoundButton(0,0,"sound_button_on","sound_button_off"),this.addChild(this.soundButton);var i=game.add.button(0,0,"gui",this.onHomeButton,this,"home_button","home_button","home_button_pushed","home_button");i.anchor.set(.5),R.sfx.button&&i.setDownSound(R.sfx.button),this.addChild(i),this.homeButton=i;var s=game.add.button(0,0,"gui",this.onRestartButton,this,"replay_button","replay_button","replay_button_pushed","replay_button");s.anchor.set(.5),R.sfx.button&&s.setDownSound(R.sfx.button),this.addChild(s),this.restartButton=s;var o=game.add.button(0,0,"gui",this.onContinueButton,this,"continue_button","continue_button","continue_button_pushed","continue_button");o.anchor.set(.5),R.sfx.button&&o.setDownSound(R.sfx.button),this.addChild(o),this.continueButton=o;var n=game.add.button(0,0,"gui",this.onTutorialButton,this,"tutorial_button","tutorial_button","tutorial_button_pushed","tutorial_button");n.anchor.set(.5),R.sfx.button&&n.setDownSound(R.sfx.button),this.addChild(n),this.tutorialButton=n,this.label=R.createText(0,0,30,R.strings.restart_warning,"#ffffff",!1,0,!0),this.label.anchor.set(.5),this.label.align="center",this.addChild(this.label),this.label.visible=!1,this.tutorialScreen=null,this.modeBefore=0,this.exists=!1},R.OptionsScreen.prototype=Object.create(Phaser.Sprite.prototype),R.OptionsScreen.prototype.constructor=R.OptionsScreen,R.OptionsScreen.prototype.resize=function(t,e){this.bg.position.set(.5*t,.5*e),this.optionsIcon.x=this.bg.x,e<t?(this.bg.rotation=.5*Math.PI,this.optionsIcon.y=90,this.layoutButton.position.set(R.halfGameWidth-238,R.halfGameHeight-50),this.modeButton.position.set(R.halfGameWidth,R.halfGameHeight-50),this.soundButton.position.set(R.halfGameWidth+238,R.halfGameHeight-50),this.homeButton.position.set(R.halfGameWidth-238,R.halfGameHeight+135),this.restartButton.position.set(R.halfGameWidth,R.halfGameHeight+135),this.continueButton.position.set(R.halfGameWidth+238,R.halfGameHeight+135),this.tutorialButton.position.set(R.halfGameWidth+268,R.halfGameHeight-205)):(this.bg.rotation=0,this.optionsIcon.y=this.bg.y-320,this.layoutButton.position.set(R.halfGameWidth-150,R.halfGameHeight-130),this.modeButton.position.set(R.halfGameWidth+150,R.halfGameHeight-130),this.soundButton.position.set(R.halfGameWidth-150,R.halfGameHeight+60),this.homeButton.position.set(R.halfGameWidth+150,R.halfGameHeight+60),this.restartButton.position.set(R.halfGameWidth-150,R.halfGameHeight+250),this.continueButton.position.set(R.halfGameWidth+150,R.halfGameHeight+250),this.tutorialButton.position.set(R.halfGameWidth+178,R.halfGameHeight-290)),this.label.position.set(this.bg.x,this.continueButton.y+120)},R.OptionsScreen.prototype.enableButtons=function(t){this.layoutButton.inputEnabled=t,this.modeButton.inputEnabled=t,this.soundButton.inputEnabled=t,this.homeButton.inputEnabled=t,this.restartButton.inputEnabled=t,this.continueButton.inputEnabled=t,this.tutorialButton.inputEnabled=t},R.OptionsScreen.prototype.open=function(){window.famobi_analytics.trackScreen("SCREEN_SETTINGS"),R.layoutRight=!R.layoutRight,this.onLayoutButton(),this.modeBefore=R.deck.mode,R.deck.mode=1===R.deck.mode?3:1,this.onModeButton(),this.soundButton.checkFrame(),game.world.add(this),this.exists=!0,this.resize(game.width,game.height),this.enableButtons(!0)},R.OptionsScreen.prototype.onLayoutButton=function(){R.layoutRight=!R.layoutRight;var t=R.layoutRight?"hand_right_button":"hand_left_button";this.layoutButton.setFrames(t,t,"hand_button_pushed",t)},R.OptionsScreen.prototype.onModeButton=function(){R.deck.mode=1===R.deck.mode?3:1;var t=1===R.deck.mode?"mode1_button":"mode3_button";this.modeButton.setFrames(t,t,"mode_button_pushed",t),this.label.visible=this.modeBefore!==R.deck.mode},R.OptionsScreen.prototype.onHomeButton=function(){var t=this;window.famobi.showAd(function(){window.famobi_analytics.trackEvent("EVENT_LEVELFAIL",{levelName:R.deck.mode.toString(),reason:"quit"}),t.enableButtons(!1),R.sceneTransition(200,"home")})},R.OptionsScreen.prototype.onRestartButton=function(){var t=this;window.famobi.showAd(function(){window.famobi_analytics.trackEvent("EVENT_LEVELFAIL",{levelName:R.deck.mode.toString(),reason:"dead"}),t.enableButtons(!1),R.sceneTransition(200,"play")})},R.OptionsScreen.prototype.onContinueButton=function(){var t=this;window.famobi.showAd(function(){t.enableButtons(!1),t.exists=!1,game.world.remove(t),t.tutorialScreen&&(t.tutorialScreen.destroy(),t.tutorialScreen=null),t.modeBefore===R.deck.mode?PlayState.onCloseOptionsScreen():(PlayState.totalStatTracking(t.modeBefore),R.sceneTransition(200,"play"))})},R.OptionsScreen.prototype.onTutorialButton=function(){window.famobi_analytics.trackScreen("SCREEN_TUTORIAL"),this.exists=!1,game.world.remove(this),this.tutorialScreen=new R.TutorialScreen},R.OptionsScreen.prototype.closeTutorial=function(){window.famobi_analytics.trackScreen("SCREEN_SETTINGS"),game.world.removeAll(),this.exists=!0,game.world.add(this)};var R,BootState={init:function(){window.famobi_analytics.trackScreen("SCREEN_SPLASH"),game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.forceOrientation(!1,!1),game.scale.onSizeChange.add(this.onSizeChange,this),game.scale.setResizeCallback(this.onResize,this),game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,document.getElementsByTagName("body")[0].style.backgroundImage="url(assets/"+(window.famobi_theme?window.famobi_theme:"")+"dtile.png)",game.input.maxPointers=1,game.stage.disableVisibilityChange=!1,this.additionalAudioCheck(),this.resizeGame()},preload:function(){game.load.atlas("load","assets/"+(window.famobi_theme?window.famobi_theme:"")+"atlas_load.png","assets/atlas_load.json")},create:function(){game.state.add("load",LoadState),game.state.add("home",HomeState),game.state.add("statistics",StatisticsState),game.state.add("play",PlayState),game.state.start("load")},onResize:function(){var t=window.innerWidth,e=window.innerHeight;R.prevWindowWidth==t&&R.prevWindowHeight==e||this.onSizeChange();var i=document.getElementById(game.parent);i.style.width=t+"px",i.style.height=e+"px"},onSizeChange:function(){this.resizeGame(),game.state.resize(R.gameWidth,R.gameHeight)},resizeGame:function(){var t=window.innerWidth,e=window.innerHeight;R.prevWindowWidth=t,(R.prevWindowHeight=e)<t?(R.gameHeight=R.BASE_GAME_HEIGHT,R.gameWidth=R.gameHeight/e*t,R.gameWidth>R.MAX_GAME_WIDTH?R.gameWidth=R.MAX_GAME_WIDTH:R.gameWidth<R.MIN_GAME_WIDTH&&(R.gameWidth=R.MIN_GAME_WIDTH)):(R.gameWidth=R.BASE_GAME_HEIGHT,R.gameHeight=R.gameWidth/t*e,R.gameHeight>R.MAX_GAME_WIDTH?R.gameHeight=R.MAX_GAME_WIDTH:R.gameHeight<R.MIN_GAME_HEIGHT&&(R.gameHeight=R.MIN_GAME_HEIGHT)),R.halfGameWidth=.5*R.gameWidth,R.halfGameHeight=.5*R.gameHeight,game.scale.setGameSize(R.gameWidth,R.gameHeight)},additionalAudioCheck:function(){function t(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537}var e=navigator.userAgent,i=/SHL24|SH-01F/i.test(e)&&t(),s=/SO-04E/i.test(e)&&t(),o=/F-01F/i.test(e)&&t();(i||s||o)&&(game.device.webAudio=!1)}},LoadState={loadText:null,logo:null,loading:null,loadingBar:null,init:function(){game.load.onFileComplete.add(this.fileComplete,this),game.load.onLoadComplete.add(this.loadComplete,this)},create:function(){for(var t in game.load.json("strings","assets/strings.json"),game.load.image("more_games",window.famobi.getMoreGamesButtonImage()),game.load.image("bg_menu","assets/"+(window.famobi_theme?window.famobi_theme:"")+"bg/bg_menu.png"),game.load.image("bg_main","assets/"+(window.famobi_theme?window.famobi_theme:"")+"bg/bg_main.png"),game.load.image("bg_main_landscape","assets/"+(window.famobi_theme?window.famobi_theme:"")+"bg/bg_main_landscape.png"),game.load.image("bg_options","assets/"+(window.famobi_theme?window.famobi_theme:"")+"bg/bg_options.png"),game.load.atlas("gui","assets/"+(window.famobi_theme?window.famobi_theme:"")+"atlas_gui.png","assets/atlas_gui.json"),game.load.image("card_skin1","assets/"+(window.famobi_theme?window.famobi_theme:"")+"skin/card_skin1.png"),game.load.image("tutorial1","assets/tutorial1.png"),game.load.image("tutorial2","assets/tutorial2.png"),R.suits)for(var e in R.values){var i=R.values[e]+R.suits[t];game.load.image(i,"assets/"+(window.famobi_theme?window.famobi_theme:"")+"deck/"+i+".png")}if(game.device.webAudio){var s=["error","card","pick_card","place_card","card_to_base","button","win","new_game"];for(var o in s)game.load.audio(s[o],["assets/sfx/"+s[o]+".mp3","assets/sfx/"+s[o]+".ogg"])}this.createEnvironment(),game.load.start()},shutdown:function(){this.loadText=null,this.logo=null,this.loading=null,this.loadingBar=null},createEnvironment:function(){game.stage.backgroundColor=window.famobi.__((window.famobi_theme?window.famobi_theme:"")+"backgroundColor"),this.logo=game.add.sprite(0,0,"load","logo"),this.logo.anchor.set(.5),this.loading=game.add.sprite(0,0,"load","loading"),this.loading.anchor.set(.5),this.loadingBar=game.add.sprite(0,0,"load","loading-bar");var t=new Phaser.Rectangle(0,0,0,32);this.loadingBar.crop(t),this.loadText=game.add.text(0,0,"",{fill:window.famobi.__((window.famobi_theme?window.famobi_theme:"")+"loadTextColor")}),this.loadText.font=R.fontName,this.loadText.fontSize=28,this.loadText.anchor.set(.5),this.loadText.align="center",this.resize(game.width,game.height)},resize:function(t,e){this.logo.x=R.halfGameWidth,this.logo.y=R.halfGameHeight-100,this.loading.x=R.halfGameWidth,this.loading.y=R.halfGameHeight+150,this.loadingBar.x=this.loading.x-227,this.loadingBar.y=this.loading.y-13,this.loadText.x=R.halfGameWidth,this.loadText.y=this.loading.y+4},fileComplete:function(t,e,i,s,o){this.loadingBar.cropRect.width=456*t*.01,this.loadingBar.updateCrop(),this.loadText.setText(t.toString()+"%")},loadComplete:function(){game.device.webAudio&&(R.sfx.button=game.add.audio("button"),R.sfx.new_game=game.add.audio("new_game"),R.sfx.win=game.add.audio("win"),R.sfx.error=game.add.audio("error"),R.sfx.card_to_base=game.add.audio("card_to_base"),R.sfx.place_card=game.add.audio("place_card"),R.sfx.pick_card=game.add.audio("pick_card"),R.sfx.card=game.add.audio("card"));var t=window.navigator.language;t=(t=t||window.navigator.browserLanguage)?t.split("-")[0]:"en";var e=game.cache.getJSON("strings");R.language=t in e?t:"en",R.strings=e.en;var i=null;for(var s in R.strings)(i=window.famobi.__(s))&&(R.strings[s]=i);R.loadGame(),R.sceneTransition(200,"home")}},HomeState={tws:[],bg:null,logo:null,buttonPlay:null,buttonGames:null,buttonStat:null,tutorialScreen:null,tutorialMode:!1,shutdown:function(){this.bg=null,this.logo=null,this.buttonPlay=null,this.buttonGames=null,this.buttonStat=null,this.tutorialScreen&&(this.tutorialScreen.destroy(),this.tutorialScreen=null),this.tws.length=0},create:function(){window.famobi_analytics.trackScreen("SCREEN_HOME"),window.famobi_analytics.trackEvent("EVENT_LIVESCORE",{liveScore:0}),this.tutorialMode?(this.tutorialScreen=new R.TutorialScreen,this.tutorialMode=!1,R.playerData.isFirstStart=!1):(this.bg=game.add.sprite(0,0,"bg_menu"),this.logo=game.add.sprite(0,0,"load","logo"),this.logo.anchor.set(.5),this.logo.alpha=0,this.buttonPlay=game.add.button(0,0,"load",this.onPlayButton,this,"play_big_button","play_big_button","play_big_button_pushed","play_big_button"),this.buttonPlay.anchor.set(.5),this.buttonPlay.scale.set(.95),this.buttonPlay.alpha=0,R.sfx.button&&this.buttonPlay.setDownSound(R.sfx.button),this.buttonGames=game.add.button(0,0,"more_games",function(){}),this.buttonGames.anchor.set(.5),this.buttonGames.scale.set(.4),this.buttonGames.alpha=0,R.sfx.button&&this.buttonGames.setDownSound(R.sfx.button),this.buttonStat=game.add.button(0,0,"gui",this.onStatButton,this,"stat_button","stat_button","stat_button_pushed","stat_button"),this.buttonStat.anchor.set(.5),this.buttonStat.scale.set(.95),this.buttonStat.alpha=0,R.sfx.button&&this.buttonStat.setDownSound(R.sfx.button),this.tws.push(game.add.tween(this.logo).to({alpha:1},500,Phaser.Easing.Linear.None,!1,0)),this.tws.push(game.add.tween(this.buttonPlay).to({alpha:1},500,Phaser.Easing.Linear.None,!1,200)),this.tws.push(game.add.tween(this.buttonPlay.scale).to({x:1,y:1},1e3,Phaser.Easing.Linear.None,!1,200,-1,!0)),this.tws.push(game.add.tween(this.buttonStat).to({alpha:1},500,Phaser.Easing.Linear.None,!1,400)),this.tws.push(game.add.tween(this.buttonGames).to({alpha:1},500,Phaser.Easing.Linear.None,!1,600)),this.shakePlayButton()),this.resize(game.width,game.height),R.sceneTransition(200,null)},resize:function(t,e){return this.tutorialScreen?void this.tutorialScreen.resize(t,e):(this.logo.x=R.halfGameWidth,void(e<t?(this.bg.rotation=-.5*Math.PI,this.bg.y=R.BASE_GAME_HEIGHT,this.logo.y=120,this.buttonStat.position.set(R.halfGameWidth-130,R.halfGameHeight+30),this.buttonPlay.position.set(R.halfGameWidth+130,this.buttonStat.y),this.buttonGames.position.set(R.halfGameWidth,e-100)):(this.bg.rotation=0,this.bg.y=0,this.logo.y=.5*(R.halfGameHeight-100),this.buttonPlay.position.set(R.halfGameWidth,R.halfGameHeight-30),this.buttonGames.position.set(R.halfGameWidth,e-75),this.buttonStat.position.set(R.halfGameWidth,this.buttonPlay.y+.57*(this.buttonGames.y-this.buttonPlay.y)))))},start:function(){for(var t in this.tws)this.tws[t].start()},shakePlayButton:function(){this.buttonPlay.rotation=0,game.time.events.add(3e3,function(){this.buttonPlay.rotation=-.05,game.add.tween(this.buttonPlay).to({rotation:.05},50,Phaser.Easing.Linear.None,!0,0,8,!0).onComplete.add(this.shakePlayButton,this)},this)},onPlayButton:function(){this.buttonPlay.inputEnabled=!1,this.buttonStat.inputEnabled=!1,R.sceneTransition(200,"play")},onCloseTutotial:function(){R.sceneTransition(200,"play")},onStatButton:function(){this.buttonPlay.inputEnabled=!1,this.buttonStat.inputEnabled=!1,R.sceneTransition(200,"statistics")}},StatisticsState={bg:null,gLabels:null,gLeft:0,buttonBack:null,shutdown:function(){this.bg=null,this.gLabels=null,this.buttonBack=null},create:function(){window.famobi_analytics.trackScreen("SCREEN_OTHER","SCREEN_STATISTICS"),this.bg=game.add.sprite(0,0,"bg_menu"),this.gLabels=game.add.group();var t=game.add.graphics(0,0);this.gLabels.add(t);var e=28,i="#ffffff",s=["games_won","games_played","best_score","least_moves","best_time","total_time"],o=136,n=0,a=[];for(var r in s){var h=this.createLabel(0,o,e,i,R.strings[s[r]]);h.width>n&&(n=h.width),a.push(h),o+=50}var d=this.createLabel(n,90,e,i,R.strings.card1),l=this.createLabel(d.x+150,d.y,e,i,R.strings.card3),c=["gamesWon","gamesPlayed","bestScore","leastMoves","bestTime","totalTime"],u=-.5*n-10,p=l.x+.5*l.width+10,m=this.createLabel(.5*this.gLabels.width+u+10,30,e,i,R.strings.statistics);for(var r in e=24,a){var g=R.playerData[c[r]+"1"],f=R.playerData[c[r]+"3"];4!=r&&5!=r||(g=this.getTimeString(g),f=this.getTimeString(f)),this.createLabel(d.x,a[r].y,e,i,g.toString()),this.createLabel(l.x,a[r].y,e,i,f.toString())}var b=m.y+30,v=this.gLabels.height,w=.5*d.x+30;t.lineStyle(4,16777215),t.moveTo(u,b),t.lineTo(p,b),t.moveTo(w,b),t.lineTo(w,v),w=d.x+.5*(d.width+(l.x-.5*l.width-d.x-.5*d.width)),t.moveTo(w,b),t.lineTo(w,v),t.lineStyle(2,16777215),t.moveTo(u,0),t.lineTo(p,0),t.lineTo(p,v),t.lineTo(u,v),t.lineTo(u,0);var y=game.add.button(0,0,"gui",this.onBackButton,this,"continue_button","continue_button","continue_button_pushed","continue_button");y.anchor.set(.5),y.scale.set(-.76,.76),R.sfx.button&&y.setDownSound(R.sfx.button),this.buttonBack=y,this.gLeft=-u,this.resize(game.width,game.height),R.sceneTransition(200,null)},getTimeString:function(t){var e=t/3600,i=Math.floor(e),s=60*(e-i),o=Math.floor(s),n=Math.floor(60*(s-o)+.5),a=i.toString()+":";return o<10&&(a+="0"),a+=o.toString()+":",n<10&&(a+="0"),a+n.toString()},createLabel:function(t,e,i,s,o){var n=R.createText(t,e,i,o,s,!1,0,!1);return n.anchor.set(.5),n.align="center",this.gLabels.add(n),n},resize:function(t,e){this.gLabels.x=.5*(t-this.gLabels.width)+this.gLeft,this.buttonBack.x=R.halfGameWidth,e<t?(this.bg.rotation=-.5*Math.PI,this.bg.y=R.BASE_GAME_HEIGHT,this.gLabels.y=10,this.buttonBack.y=this.gLabels.y+this.gLabels.height+70):(this.bg.rotation=0,this.bg.y=0,this.gLabels.y=.5*(e-this.gLabels.height)-100,this.buttonBack.y=this.gLabels.y+this.gLabels.height+100)},onBackButton:function(){this.buttonBack.inputEnabled=!1,R.sceneTransition(200,"home")}},PlayState={bg:null,bg_portrait:null,bg_landscape:null,buttonOptions:null,retryButton:null,iconPoints:null,iconTime:null,iconMoves:null,labelScore:null,labelTime:null,labelMoves:null,cardPicked:null,prevCardPicked:null,baseCardPosition:null,pointerOffset:null,displayScore:0,moves:0,timePick:0,AUTO_PUT_DELAY:.4,allPlayObjects:[],optionsScreen:null,teDecreaseScore:null,shutdown:function(){1===R.deck.state&&(this.totalStatTracking(R.deck.mode),R.saveGame()),this.allPlayObjects.length=0,this.bg=null,this.buttonOptions=null,this.retryButton=null,this.iconPoints=null,this.iconTime=null,this.iconMoves=null,this.labelScore=null,this.labelTime=null,this.labelMoves=null,this.cardPicked=null,this.prevCardPicked=null,this.baseCardPosition=null,this.pointerOffset=null,this.optionsScreen=null,this.teDecreaseScore=null,R.deck.shutdown()},create:function(){window.famobi_analytics.trackScreen("SCREEN_LEVEL"),window.famobi_analytics.trackEvent("EVENT_LEVELSTART",{levelName:R.deck.mode.toString()}),this.baseCardPosition=new Phaser.Point(0,0),this.bg_portrait=game.add.sprite(0,0,"bg_main"),this.bg_portrait.visible=!1,this.bg_landscape=game.add.sprite(0,0,"bg_main_landscape"),this.bg_landscape.visible=!1,"landscape"==window.famobi.getOrientation()?this.bg=this.bg_landscape:this.bg=this.bg_portrait,this.bg.visible=!0,this.buttonOptions=game.add.button(0,0,"gui",this.onOptionsButton,this,"options_button","options_button","options_button_pushed","options_button"),this.buttonOptions.anchor.set(.5),R.sfx.button&&this.buttonOptions.setDownSound(R.sfx.button),this.retryButton=game.add.button(0,0,"gui",R.moveSaver.undo,R.moveSaver,"retry_button","retry_button","retry_button_pushed","retry_button"),this.retryButton.anchor.set(.5),this.iconPoints=game.add.sprite(0,0,"gui","points_icon"),this.iconPoints.anchor.set(.5),this.iconTime=game.add.sprite(0,0,"gui","time_icon"),this.iconTime.anchor.set(.5),this.iconMoves=game.add.sprite(0,0,"gui","moves_button"),this.iconMoves.anchor.set(.5),this.labelScore=R.createText(0,0,30,"0","#ffffff"),this.labelTime=new R.Clock(0,0,30,"#ffffff"),game.world.add(this.labelTime),this.labelMoves=R.createText(0,0,30,"0","#ffffff"),R.deck.init(),this.optionsScreen=new R.OptionsScreen,this.resize(game.width,game.height),R.sceneTransition(200,null),R.sfx.new_game&&R.sfx.new_game.play()},resize:function(t,e){return this.bg.visible=!1,this.optionsScreen.exists?void this.optionsScreen.resize(t,e):this.optionsScreen.tutorialScreen?void this.optionsScreen.tutorialScreen.resize(t,e):(e<t?(this.bg=this.bg_landscape,this.bg.rotation=-.5*Math.PI,this.bg.y=R.BASE_GAME_HEIGHT,this.buttonOptions.position.set(93,130),this.retryButton.position.set(93,515),this.iconPoints.position.set(50,287),this.iconTime.position.set(50,341),this.iconMoves.position.set(50,391)):(this.bg=this.bg_portrait,this.bg.rotation=0,this.bg.y=0,this.buttonOptions.position.set(93,92),this.retryButton.position.set(546,93),this.iconPoints.position.set(264,50),this.iconTime.position.set(264,104),this.iconMoves.position.set(264,154)),this.bg.visible=!0,this.labelScore.position.set(this.iconPoints.x+120,this.iconPoints.y+4),this.labelTime.position.set(this.iconTime.x+120,this.iconTime.y+6),this.labelMoves.position.set(this.iconMoves.x+120,this.iconMoves.y+2),void R.deck.resize(t,e))},inputOnDown:function(t,e){if(0===R.deck.state)return R.deck.state=1,void this.resize(game.width,game.height);if(0<game.tweens._tweens.length)R.sfx.error&&R.sfx.error.play();else{var i=R.deck.pick(t.x,t.y);i&&i.parent===game.world&&(game.device.desktop&&i===this.prevCardPicked&&game.time.totalElapsedSeconds()-this.timePick<this.AUTO_PUT_DELAY?(this.prevCardPicked=null,R.deck.autoPut(i)):(i.setOnTop(),this.pointerOffset=Phaser.Point.subtract(i,t),this.cardPicked=i,this.baseCardPosition.set(i.x,i.y),this.timePick=game.time.totalElapsedSeconds(),R.sfx.pick_card&&R.sfx.pick_card.play()))}},inputOnUp:function(t,e){this.cardPicked&&(!game.device.desktop&&Phaser.Point.distance(this.cardPicked,this.baseCardPosition)<5?R.deck.autoPut(this.cardPicked):R.deck.put(this.cardPicked,.25<game.time.totalElapsedSeconds()-this.timePick),this.prevCardPicked=this.cardPicked,this.cardPicked=null)},start:function(){R.deck.start(),game.input.onDown.add(this.inputOnDown,this),game.input.onUp.add(this.inputOnUp,this)},beginPlay:function(){R.deck.state=1,R.score=0,window.famobi_analytics.trackEvent("EVENT_LIVESCORE",{liveScore:R.score}),this.displayScore=0,this.moves=0,this.timePick=0,R.moveSaver.reset(),this.labelTime.reset(!0),this.teDecreaseScore=game.time.events.loop(3e4,R.scoreChange,R,-5),game.time.events.loop(75,this.updateLabelScore,this)},update:function(){this.cardPicked&&this.cardPicked.setPosition(game.input.activePointer.x+this.pointerOffset.x,game.input.activePointer.y+this.pointerOffset.y)},updateLabelScore:function(){this.labelScore.text=R.score.toString()},onOptionsButton:function(){this.labelTime.pause(!0),game.input.onDown.remove(this.inputOnDown,this),game.input.onUp.remove(this.inputOnUp,this),R.deck.state=1,this.resize(game.width,game.height);for(var t=game.world.children.length;t--;)this.allPlayObjects.push(game.world.children[t]);game.world.removeAll(!1,!0),this.optionsScreen.open()},onCloseOptionsScreen:function(){window.famobi_analytics.trackScreen("SCREEN_LEVEL");for(var t=this.allPlayObjects.length;t--;)game.world.add(this.allPlayObjects[t]);this.allPlayObjects.length=0,this.resize(game.width,game.height),game.input.onDown.add(this.inputOnDown,this),game.input.onUp.add(this.inputOnUp,this),this.labelTime.pause(!1)},onCloseTutotial:function(){this.optionsScreen&&this.optionsScreen.closeTutorial()},move:function(){++this.moves,this.labelMoves.text=this.moves.toString()},totalStatTracking:function(t){var e=t.toString();++R.playerData["gamesPlayed"+e],R.playerData["totalTime"+e]+=this.labelTime.getTotalSeconds(),R.deck.state=0},win:function(){game.input.onDown.remove(this.inputOnDown,this),game.input.onUp.remove(this.inputOnUp,this),game.time.events.remove(this.teDecreaseScore),this.labelTime.stopTick(),this.buttonOptions.inputEnabled=!1,this.retryButton.inputEnabled=!1,this.teDecreaseScore=game.time.events.loop(100,this.updateWon,this),game.time.events.add(500,function(){game.input.onDown.add(this.inputOnDownWin,this)},this),R.sfx.win&&R.sfx.win.play()},inputOnDownWin:function(t,e){this.closeWin()},updateWon:function(){0===R.flyCards&&game.world.children.length<27&&this.closeWin()},closeWin:function(){window.famobi_analytics.trackEvent("EVENT_LEVELSUCCESS",{levelName:R.deck.mode.toString()});var t=R.deck.mode.toString();++R.playerData["gamesWon"+t],R.playerData["bestScore"+t]<R.score&&(R.playerData["bestScore"+t]=R.score),(0===R.playerData["leastMoves"+t]||R.playerData["leastMoves"+t]>this.moves)&&(R.playerData["leastMoves"+t]=this.moves);var e=this.labelTime.getTotalSeconds();(0===R.playerData["bestTime"+t]||R.playerData["bestTime"+t]>e)&&(R.playerData["bestTime"+t]=e),window.famobi_analytics.trackEvent("EVENT_TOTALSCORE",{totalScore:R.score}),game.input.onDown.remove(this.inputOnDownWin,this),game.time.events.remove(this.teDecreaseScore),R.sceneTransition(200,"home")}};(R=R||{}).Clock=function(t,e,i,s){Phaser.Text.call(this,game,t,e,"0:00"),this.font=R.fontName,this.anchor.set(1,.5),this.align="right",this.fontSize=i,this.fill=s,this.fontWeight="100",this.minutes=0,this.seconds=0,this.timer=game.time.add(new Phaser.Timer(game,!0)),this.timer.loop(1e3,this.updateTime,this),this.timer.stop(!1)},R.Clock.prototype=Object.create(Phaser.Text.prototype),R.Clock.prototype.constructor=R.Clock,R.Clock.prototype.reset=function(t){this.seconds=this.minutes=0,t&&(this.timer.start(),this.text="0:00")},R.Clock.prototype.updateTime=function(){60==++this.seconds&&(this.seconds=0,++this.minutes);var t=this.minutes.toString()+":";this.seconds<10&&(t+="0"),t+=this.seconds.toString(),this.text=t},R.Clock.prototype.stopTick=function(){this.timer.stop(!1)},R.Clock.prototype.pause=function(t){t?this.timer.pause():this.timer.resume()},R.Clock.prototype.getTotalSeconds=function(){return 60*this.minutes+this.seconds},(R=R||{}).suits=["c","d","h","s"],R.values=["a","2","3","4","5","6","7","8","9","10","j","q","k"],R.layoutRight=!0,R.wCard=86,R.hCard=118,R.xColumnDistance=5,R.hCardOffsetClose=12,R.hCardOffsetOpen=30,R.flyCards=0,R.score=0,R.scoreChange=function(t){R.score+=t,R.score<0&&(R.score=0)},R.CardData=function(t,e){this.si=1*t,this.vi=1*e,this.suit=R.suits[t],this.value=R.values[e],this.name=this.value+this.suit},R.CardData.prototype={},R.CardData.prototype.constructor=R.CardData,R.Card=function(t){Phaser.Sprite.call(this,game,0,0,"card_skin1"),this.cardData=t,this.isOpen=!1,this.under=null,this.over=null,this.column=null,this.prevOwner=null,this.isColumnNotMoved=!0,this.isHomeNotMoved=!0,this.tween=null},R.Card.prototype=Object.create(Phaser.Sprite.prototype),R.Card.prototype.constructor=R.Card,R.Card.prototype.open=function(t,e){this.isOpen=t,e?(this.anchor.set(.5),this.x+=.5*this.width,this.y+=.5*this.height,this.tween=game.add.tween(this.scale).to({x:.1,y:1.2},100,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(function(t){this.loadTexture(t?this.cardData.name:"card_skin1"),this.tween=game.add.tween(this.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(function(){this.tween=null,this.anchor.set(0),this.x-=.5*this.width,this.y-=.5*this.height},this)},this,t)):this.loadTexture(t?this.cardData.name:"card_skin1")},R.Card.prototype.add=function(t){((t.under=this).over=t).makeTween(this.x,this.y+(this.isOpen?R.hCardOffsetOpen:R.hCardOffsetClose),0)},R.Card.prototype.makeTween=function(t,e,i){var s={x:t,y:e},o=Phaser.Point.distance(this,s)/1.6;o<1&&(o=1),this.tween=game.add.tween(this).to(s,o,Phaser.Easing.Linear.None,!0,i),this.tween.onComplete.add(function(){this.tween=null},this),this.over&&this.oversToChildren(),R.sfx.card&&this.tween.onStart.add(function(){R.sfx.card.play()},this),R.sfx.place_card&&this.tween.onComplete.add(function(){R.sfx.place_card.play()},this)},R.Card.prototype.oversToChildren=function(){for(var t=this.over,e=1;t;)t.position.set(0,R.hCardOffsetOpen*e++),this.addChild(t),t=t.over;this.tween.onComplete.add(this.recoverOvers,this)},R.Card.prototype.recoverOvers=function(){this.removeChildren();for(var t=this.over;t;)game.world.add(t),t=t.over;this.setPosition(this.x,this.y)},R.Card.prototype.setPosition=function(t,e){this.tween&&(this.bringToTop(),this.tween.stop(!0)),this.position.set(t,e);for(var i=this.over;i;)i.tween&&(i.bringToTop(),i.tween.stop(!0)),i.position.set(t,i.under.y+(i.under.isOpen?R.hCardOffsetOpen:R.hCardOffsetClose)),i=i.over},R.Card.prototype.setOnTop=function(){this.bringToTop();for(var t=this.over;t;)t.bringToTop(),t=t.over},R.Card.prototype.startWinAnim=function(){this.vY=-3,this.vX=R.layoutRight?1.5:-1.5,this.anchor.x=.5,this.x+=.5*this.width,++R.flyCards,game.world.addAt(this,20),this.update=this.updateWinAnim},R.Card.prototype.updateWinAnim=function(){this.x+=this.vX,this.y+=this.vY,this.vY+=.1;var t=this.y+this.height*this.scale.y;if(t>game.height){if(this.scale.y=(this.height*this.scale.y-t+game.height)/this.height,this.scale.y<.5){for(var e=game.device.desktop?1*this.cardData.vi+1:1;e--;)new R.ParticleSuit(this);--R.flyCards,game.world.remove(this,!0)}this.scale.x=2-this.scale.y}},R.Column=function(){Phaser.Sprite.call(this,game,0,0,"gui","card_place"),this.bottomCard=null,this.topCard=null,game.world.add(this)},R.Column.prototype=Object.create(Phaser.Sprite.prototype),R.Column.prototype.constructor=R.Column,R.Column.prototype.setPosition=function(t,e){this.position.set(t,e),this.bottomCard&&this.bottomCard.setPosition(t,e)},R.Column.prototype.add=function(t,e){if(t.column&&t.column.remove(t),this.topCard?this.topCard.add(t):(t.makeTween(this.x,this.y,0),t.tween.onComplete.add(function(){this.visible=!1},this),this.bottomCard=t),t.tween.onComplete.add(R.deck.isAllSorted,R.deck),t.over)for(var i=t.over;i;)(this.topCard=i).column=this,i=i.over;else this.topCard=t;t.column=this,1===R.deck.state&&t.isColumnNotMoved&&(t.isColumnNotMoved=!1,R.scoreChange(5)),t.prevOwner&&t.prevOwner!==R.deck.srcOpen&&(t.prevOwner=null,t.isHomeNotMoved=!0,R.scoreChange(-15))},R.Column.prototype.remove=function(t){this.topCard=t.under,this.topCard?(this.topCard.over=null,this.topCard.isOpen||this.topCard.open(!0,!0)):this.bottomCard=null,t.under=null,t.column=null},R.Column.prototype.pick=function(t,e){for(var i=this.topCard;i&&i.isOpen;){if(i.getBounds().contains(t,e))return i===this.bottomCard&&(this.visible=!0),i;i=i.under}return null},R.Column.prototype.autoPlacePick=function(){var t=this.topCard;return t===this.bottomCard&&(this.visible=!0),this.remove(t),t},R.Column.prototype.checkCard=function(t){if(this.topCard){var e=!1;switch(this.topCard.cardData.suit){case"s":case"c":e="h"===t.suit||"d"===t.suit;break;case"h":e="s"===t.suit||"c"===t.suit;break;case"d":e="s"===t.suit||"c"===t.suit}return e&&t.vi+1===this.topCard.cardData.vi}return"k"===t.value},R.Column.prototype.isSorted=function(){for(var t=this.bottomCard;t;){if(!t.isOpen)return!1;t=t.over}return!0},R.SuitDeck=function(){Phaser.Sprite.call(this,game,0,0,"gui","card_place"),this.pile=[],this.topCard=null,game.world.add(this)},R.SuitDeck.prototype=Object.create(Phaser.Sprite.prototype),R.SuitDeck.prototype.constructor=R.SuitDeck,R.SuitDeck.prototype.add=function(t){this.topCard=t,this.pile.push(t),t.makeTween(this.x,this.y,0),t.tween.onComplete.add(function(){this.topCard.column&&this.topCard.column.remove(this.topCard),game.world.remove(this.topCard),this.loadTexture(this.topCard.cardData.name),R.deck.isWin(),R.deck.isAllSorted()},this),t.isHomeNotMoved&&(t.isColumnNotMoved=!1,t.isHomeNotMoved=!1,R.scoreChange(15)),t.prevOwner=this,R.sfx.card_to_base&&R.sfx.card_to_base.play()},R.SuitDeck.prototype.autoPlaceAdd=function(t,e){this.topCard=t,this.pile.push(t),t.makeTween(this.x,this.y,e),t.tween.onStart.add(t.bringToTop,t),t.tween.onComplete.add(function(t){game.world.remove(t),this.loadTexture(t.cardData.name),PlayState.displayScore+=14,R.score+=15},this,t)},R.SuitDeck.prototype.pick=function(t,e){if(this.topCard&&this.getBounds().contains(t,e)){var i=this.topCard;return this.pile.pop(),0<this.pile.length?(this.topCard=this.pile[this.pile.length-1],this.loadTexture(this.topCard.cardData.name)):(this.loadTexture("gui","card_place"),this.topCard=null),i.position.set(this.x,this.y),game.world.add(i),i}return null},R.SuitDeck.prototype.startWin=function(){var t=this.pile.pop();t.position.set(this.x,this.y),t.startWinAnim(),0<this.pile.length?(game.time.events.add(500,this.startWin,this),this.loadTexture(t.cardData.name)):this.loadTexture("gui","card_place")},R.SuitDeck.prototype.checkCard=function(t){return this.topCard?this.topCard.cardData.si===t.si&&t.vi-1===this.topCard.cardData.vi:0===t.vi},R.moveSaver={card:null,under:null,column:null,prevOwner:null,isColumnNotMoved:!1,isHomeNotMoved:!1,underIsOpen:!1,reset:function(){this.card=null,this.under=null},save:function(t){this.card=t,this.column=t.column,this.prevOwner=t.prevOwner,this.isColumnNotMoved=t.isColumnNotMoved,this.isHomeNotMoved=t.isHomeNotMoved,this.under=t.under,t.under&&(this.underIsOpen=t.under.isOpen)},undo:function(){var t=this;window.famobi.showAd(function(){t.reallyUndo()})},reallyUndo:function(){return 0<game.tweens._tweens.length||!this.card?void(R.sfx.error&&R.sfx.error.play()):(this.card.column?this.card.column.pick(this.card.x+5,this.card.y+5):this.card.prevOwner&&this.card.prevOwner!==R.deck.srcOpen&&this.card.prevOwner.pick(this.card.x+5,this.card.y+5),this.column?(this.under&&this.under.open(this.underIsOpen,!1),this.column.add(this.card,0),this.card.bringToTop(),!this.isColumnNotMoved||this.card.prevOwner&&this.card.prevOwner!==R.deck.srcOpen||R.scoreChange(-5)):this.prevOwner?(this.prevOwner===R.deck.srcOpen?(this.card.column?(this.card.column.remove(this.card),this.card.column=null,R.scoreChange(-5)):R.scoreChange(-15),R.deck.backToSrcOpen(this.card)):this.prevOwner.add(this.card),this.card.prevOwner=this.prevOwner):R.deck.popBackToSrcClose(),this.card.isColumnNotMoved=this.isColumnNotMoved,this.card.isHomeNotMoved=this.isHomeNotMoved,this.reset(),void PlayState.move())}},R.ParticleSuit=function(t){var e="";switch(t.cardData.suit){case"c":e="clubs";break;case"d":e="diamonds";break;case"h":e="hearts";break;case"s":e="spades"}Phaser.Sprite.call(this,game,t.x,t.y,"gui",e),this.anchor.set(.5),this.dx=game.rnd.between(.5,2),game.rnd.between(0,1)&&(this.dx=-this.dx),this.dy=-game.rnd.between(4,8),this.g=game.rnd.realInRange(.05,.2),this.dr=game.rnd.realInRange(.05,.1),game.rnd.between(0,1)&&(this.dr=-this.dr),this.s=game.rnd.realInRange(.3,.8),this.cs=this.s,this.ds=game.rnd.realInRange(.01,.06),this.dsx=game.rnd.between(0,1),this.scale.set(this.s),game.world.add(this)},R.ParticleSuit.prototype=Object.create(Phaser.Sprite.prototype),R.ParticleSuit.prototype.constructor=R.ParticleSuit,R.ParticleSuit.prototype.update=function(){this.x+=this.dx,this.y+=this.dy,this.rotation+=this.dr,this.dy+=this.g,this.cs-=this.ds,this.cs<-this.s&&(this.cs=this.s),this.dsx?this.scale.x=this.cs:this.scale.y=this.cs,this.y-this.height>game.height&&game.world.remove(this,!0)},(R=R||{}).deck={cards:[],cardsOpen:[],columns:[],srcPlace:null,srcOpen:null,state:0,mode:1,currentOpenCards:0,suitDecks:[],shutdown:function(){this.cards.length=0,this.columns.length=0,this.suitDecks.length=0,this.cardsOpen.length=0,this.srcPlace=null,this.srcOpen=null,this.state=0,this.currentOpenCards=0},init:function(){for(var t=0;t<4;t++)this.suitDecks.push(new R.SuitDeck);for(t=0;t<7;t++)this.columns.push(new R.Column);this.srcPlace=game.add.sprite(0,0,"gui","card_place"),this.srcPlace.visible=!1,this.srcOpen=game.add.sprite(0,0,null),this.srcOpen.visible=!1;var e=[];for(var i in R.suits)for(var s in R.values)e.push(new R.CardData(i,s));for(var o=e.length;o--;){t=game.rnd.between(0,e.length-1);var n=new R.Card(e[t]);this.cards.push(n),game.world.add(n),e.splice(t,1)}},resize:function(t,e){var i=0,s=0,o=0,n=0;if(n=e<t?(i=.5*(t+192-(7*R.wCard+6*R.xColumnDistance)),s=200,70):(i=.5*(t-(7*R.wCard+6*R.xColumnDistance)),s=332,202),R.layoutRight){for(var a in this.columns)this.columns[a].setPosition(i,s),i+=R.wCard+R.xColumnDistance;o=this.columns[0].x}else{for(a=this.columns.length;a--;)this.columns[a].setPosition(i,s),i+=R.wCard+R.xColumnDistance;o=this.columns[3].x}for(var a in this.suitDecks)this.suitDecks[a].position.set(o,n),o+=R.wCard+R.xColumnDistance;for(var a in this.srcPlace.position.set(this.columns[0===this.state?4:6].x,n),this.srcOpen.position.set(this.columns[5].x,n),3===this.mode&&this.fixSrcOpen3Pos(),this.cards)this.cards[a].tween&&this.cards[a].tween.stop(!0),this.cards[a].position.set(this.srcPlace.x,this.srcPlace.y)},start:function(){for(var t=[1,2,3,4,5,6,7],e=[0,0,0,0,0,0,0],i=0,s=0;s<28;)for(var o in this.columns)if(e[o]!==t[o]){var n=this.cards.pop();e[o]===t[o]-1&&n.open(!0),this.columns[o].add(n,i),n.tween.stop(!1),n.makeTween(this.columns[o].x,this.columns[o].y+R.hCardOffsetClose*e[o],i),n.tween.onStart.add(n.bringToTop,n),i+=100,++e[o],++s}for(var s in this.srcPlace.x=this.columns[6].x,this.cards)this.cards[s].makeTween(this.srcPlace.x,this.srcPlace.y,i),i+=10;this.cards[this.cards.length-1].tween.onComplete.add(this.beginPlay,this)},beginPlay:function(){for(var t=this.cards.length;t--;)game.world.remove(this.cards[t]);this.srcPlace.loadTexture("card_skin1"),this.srcPlace.visible=!0,PlayState.beginPlay()},pick:function(t,e){var i=null;if(e<this.columns[0].y){if(0<this.cardsOpen.length&&this.srcOpen.getBounds().contains(t,e)){if((i=this.cardsOpen.pop()).position.set(this.srcOpen.x,this.srcOpen.y),0<this.cardsOpen.length){var s=this.cardsOpen[this.cardsOpen.length-1];this.srcOpen.loadTexture(s.cardData.name),3===this.mode&&(1<this.currentOpenCards?this.srcOpen.x=this.columns[R.layoutRight?4:5].x+(this.currentOpenCards-2)*R.wCard*.5:this.srcOpen.x=this.columns[R.layoutRight?4:5].x,game.world.remove(s))}else this.srcOpen.visible=!1;return 3===this.mode&&--this.currentOpenCards,game.world.add(i),i.prevOwner=this.srcOpen,i}if(this.srcPlace.getBounds().contains(t,e))return(0<this.cards.length||0<this.cardsOpen.length)&&PlayState.move(),this.popCardClose(),null;for(var o in this.suitDecks)if(i=this.suitDecks[o].pick(t,e))return i}for(var o in this.columns)if(i=this.columns[o].pick(t,e))return i;return null},put:function(t,e){var i=1/0,s=0;if(!t.over){var o=null;for(var n in this.suitDecks)(s=Phaser.Point.distance(t,this.suitDecks[n]))<R.wCard&&s<i&&(i=s,o=this.suitDecks[n]);if(o&&o.checkCard(t.cardData))return R.moveSaver.save(t),o.add(t),void PlayState.move()}var a=null,r=null,h=null;for(var n in i=1/0,this.columns)(h=this.columns[n])!==t.column&&(r=h.topCard?h.topCard:h,(s=Phaser.Point.distance(t,r))<R.wCard&&s<i&&(i=s,a=h));return a&&a.checkCard(t.cardData)?(R.moveSaver.save(t),a.add(t,0),void PlayState.move()):(this.back(t),void(e&&R.sfx.error&&R.sfx.error.play()))},back:function(t){var e=null;t.column?(e=t.under?{x:t.under.x,y:t.under.y+(t.under.isOpen?R.hCardOffsetOpen:R.hCardOffsetClose)}:t.column,t.makeTween(e.x,e.y,0)):t.prevOwner===this.srcOpen?this.backToSrcOpen(t):t.prevOwner.add(t)},autoPut:function(t){if(!t.over)for(var e in this.suitDecks)if(this.suitDecks[e].checkCard(t.cardData))return R.moveSaver.save(t),this.suitDecks[e].add(t),void PlayState.move();for(var e in this.columns)if(this.columns[e].checkCard(t.cardData))return R.moveSaver.save(t),this.columns[e].add(t,0),void PlayState.move();this.back(t),R.sfx.error&&R.sfx.error.play()},backToSrcOpen:function(t){3===this.mode&&0<this.currentOpenCards++&&(game.world.add(this.cardsOpen[this.cardsOpen.length-1]),t.bringToTop(),this.srcOpen.bringToTop(),this.srcOpen.visible=!1,this.srcOpen.x+=.5*R.wCard),this.addCardToSrcOpen(t)},popCardClose:function(){if(0===this.cards.length){if(0===this.cardsOpen.length)return;var t=0,e=null;for(var i in this.cardsOpen)(e=this.cardsOpen[i]).open(!1),e.position.set(this.srcOpen.x,this.srcOpen.y),game.world.add(e),e.makeTween(this.srcPlace.x,this.srcPlace.y,t),t+=10;return this.srcOpen.visible=!1,this.cardsOpen[this.cardsOpen.length-1].tween.onComplete.add(this.backToSrcClose,this),void R.scoreChange(-15)}3===this.mode&&0<this.currentOpenCards&&this.beforeSrcOpen3();for(i=0;i<this.mode;++i){e=this.cards.pop();if(game.world.add(e),e.open(!0),1===this.mode?this.addCardToSrcOpen(e):this.addCardToSrcOpen3(e,i),R.moveSaver.save(e),0===this.cards.length)return void this.srcPlace.loadTexture("gui","card_place")}},addCardToSrcOpen:function(t){this.cardsOpen.push(t),t.makeTween(this.srcOpen.x,this.srcOpen.y,0),t.tween.onComplete.add(function(){var t=this.cardsOpen[this.cardsOpen.length-1];this.srcOpen.loadTexture(t.cardData.name),this.srcOpen.visible=!0,t.prevOwner=null,game.world.remove(t)},this)},addCardToSrcOpen3:function(t,e){this.currentOpenCards=e+1,this.cardsOpen.push(t),this.srcOpen.x=this.columns[R.layoutRight?4:5].x+e*R.wCard*.5,t.makeTween(this.srcOpen.x,this.srcOpen.y,100*e),2!==e&&0!==this.cards.length||t.tween.onComplete.add(function(){var t=this.cardsOpen[this.cardsOpen.length-1];game.world.remove(t),this.srcOpen.loadTexture(t.cardData.name),this.srcOpen.visible=!0,this.srcOpen.bringToTop();for(var e=this.cardsOpen.length-this.currentOpenCards;e--;)game.world.remove(this.cardsOpen[e])},this)},beforeSrcOpen3:function(){var t=this.cardsOpen[this.cardsOpen.length-1];t.position.set(this.srcOpen.x,this.srcOpen.y),game.world.add(t),this.srcOpen.visible=!1,this.srcOpen.x=this.columns[R.layoutRight?4:5].x;for(var e=this.currentOpenCards;0<e;--e)this.cardsOpen[this.cardsOpen.length-e].makeTween(this.srcOpen.x,this.srcOpen.y,0)},backToSrcClose:function(){for(var t=this.cardsOpen.length,e=null;t--;)e=this.cardsOpen.pop(),this.cards.push(e),game.world.remove(e);this.srcPlace.loadTexture("card_skin1"),this.currentOpenCards=0},fixSrcOpen3Pos:function(){0<this.currentOpenCards?this.srcOpen.x=this.columns[R.layoutRight?4:5].x+(this.currentOpenCards-1)*R.wCard*.5:this.srcOpen.x=this.columns[R.layoutRight?4:5].x;var t=null;for(var e in this.cardsOpen)(t=this.cardsOpen[e]).tween&&t.tween.stop(!0);for(e=1;e<this.currentOpenCards;++e)this.cardsOpen[this.cardsOpen.length-e-1].position.set(this.srcOpen.x-e*R.wCard*.5,this.srcOpen.y)},popBackToSrcClose:function(){for(var t=3===this.mode?this.currentOpenCards:1,e=0;e<t;++e){var i=this.cardsOpen.pop();this.cards.push(i),i.open(!1),i.position.set(this.srcOpen.x,this.srcOpen.y),game.world.add(i),i.makeTween(this.srcPlace.x,this.srcPlace.y,0),i.tween.onComplete.add(function(t){game.world.remove(t),this.srcPlace.loadTexture("card_skin1")},this,i)}if((this.currentOpenCards=0)<this.cardsOpen.length){if(this.srcOpen.loadTexture(this.cardsOpen[this.cardsOpen.length-1].cardData.name),3===this.mode){for(e=this.cardsOpen.length;e--&&this.currentOpenCards<3;)++this.currentOpenCards;if(this.srcOpen.x=this.columns[R.layoutRight?4:5].x+(this.currentOpenCards-1)*R.wCard*.5,2<this.currentOpenCards){i=this.cardsOpen[this.cardsOpen.length-3];game.world.add(i),i.position.set(this.srcOpen.x-R.wCard,this.srcOpen.y,100)}if(1<this.currentOpenCards){i=this.cardsOpen[this.cardsOpen.length-2];game.world.add(i),i.position.set(this.srcOpen.x-.5*R.wCard,this.srcOpen.y,200)}this.srcOpen.bringToTop()}}else this.srcOpen.visible=!1},isAllSorted:function(){if(!(0<this.cards.length||0<this.cardsOpen.length)){for(var t in this.columns)if(!this.columns[t].isSorted())return;this.autoPlace()}},autoPlace:function(){for(var t=0,e=null,i=null,s=null,o=0;o<this.columns.length;)for(var n in o=0,this.columns)(e=this.columns[n]).topCard?(i=this.checkCorrectSuitDeck(e.topCard.cardData))&&(i.autoPlaceAdd(s=e.autoPlacePick(),t),t+=100):++o;s.tween.onComplete.add(this.isWin,this)},checkCorrectSuitDeck:function(t){for(var e in this.suitDecks)if(this.suitDecks[e].checkCard(t))return this.suitDecks[e];return null},isWin:function(){for(var t in this.suitDecks)if(!this.suitDecks[t].topCard||"k"!=this.suitDecks[t].topCard.cardData.value)return;R.flyCards=0;var e=100;for(var t in this.suitDecks)game.time.events.add(e,this.suitDecks[t].startWin,this.suitDecks[t]),e+=300;PlayState.win()}},(R=R||{}).TutorialScreen=function(){this.bg=game.add.sprite(0,0,"bg_menu"),this.picture=game.add.sprite(0,0,"tutorial1"),this.picture.anchor.set(.5,0),this.textField=R.createText(0,0,parseInt(window.famobi.__("tutorial1_fontsize")),R.strings.tutorial1,"#ffffff",!1,0,!0),this.textField.anchor.set(.5,0),this.textField.align="center";var t=game.add.button(0,0,"gui",this.onNextButton,this,"continue_button","continue_button","continue_button_pushed","continue_button");t.anchor.set(.5),t.scale.set(.5),R.sfx.button&&t.setDownSound(R.sfx.button),this.nextButton=t;var e=game.add.button(0,0,"gui",this.onCloseButton,this,"close_button","close_button","close_button_pushed","close_button");e.anchor.set(.5),e.scale.set(1.34),R.sfx.button&&e.setDownSound(R.sfx.button),this.closeButton=e;var i=game.add.button(0,0,"gui",this.onPreviousButton,this,"continue_button","continue_button","continue_button_pushed","continue_button");i.anchor.set(.5),i.scale.set(-.5,.5),R.sfx.button&&i.setDownSound(R.sfx.button),this.previousButton=i,this.step=0,this.resize(game.width,game.height)},R.TutorialScreen.prototype={resize:function(t,e){this.picture.position.set(.5*t,10),this.textField.position.set(this.picture.x,this.picture.y+360),this.textField.wordWrapWidth=t-10,this.previousButton.position.set(this.picture.x-240,e-100),this.closeButton.position.set(this.picture.x,this.previousButton.y),this.nextButton.position.set(this.picture.x+240,this.previousButton.y),e<t?(this.bg.rotation=-.5*Math.PI,this.bg.y=R.BASE_GAME_HEIGHT):(this.bg.rotation=0,this.bg.y=0)},onNextButton:function(){1===this.step?this.onCloseButton():(this.step=1,this.picture.loadTexture("tutorial2",0),this.textField.text=R.strings.tutorial2)},onPreviousButton:function(){this.step=0,this.picture.loadTexture("tutorial1",0),this.textField.text=R.strings.tutorial1},onCloseButton:function(){this.nextButton.inputEnabled=!1,this.closeButton.inputEnabled=!1,this.previousButton.inputEnabled=!1;var t=game.state.getCurrentState();"onCloseTutotial"in t?t.onCloseTutotial():R.sceneTransition(200,"home")},destroy:function(){this.previousButton.destroy(!0),this.closeButton.destroy(!0),this.nextButton.destroy(!0),this.textField.destroy(!0),this.picture.destroy(!0),this.bg.destroy(!0)}},R.TutorialScreen.prototype.constructor=R.TutorialScreen;